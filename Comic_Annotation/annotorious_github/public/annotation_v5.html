<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>Annotation</title>
  <!-- Favicon-->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="css/styles.css" rel="stylesheet" />

  <!-- New -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

  <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
          integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
          crossorigin="anonymous"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- cropper -->
  <!-- https://jamesooi.design/Croppr.js/ -->
  <!-- <script src="../../node_modules/croppr/dist/croppr.js"></script>
        <link rel="stylesheet" href="../../node_modules/croppr/dist/croppr.css"> -->

  <!-- Annotorious -->
  <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="annotorious.min.css">
  <script src="annotorious.min.js"></script>

</head>
<style>
  /* .modal {
          padding: 18px;
          position: absolute;
          border: 1px solid lightgrey;
          left: 50%;
          transform: translateX(-50%);
          width: 300px;
      }
      
      .modal img {
          max-width: 100%;
      } */

  html,
  body {
    padding: 20px;
    margin: 0px;
    font-family: 'Lato', sans-serif;
  }

  #content {
    width: 100%;
  }

  h1 {
    font-size: 21px;
    font-weight: normal;
    margin: 0;
    padding: 0;
  }

  p.instructions {
    padding: 10px 0;
  }

  img {
    max-width: 100%;
  }

  p.caption {
    font-family: Arial, Helvetica, sans-serif;
    color: #8f8f8f;
  }

  p.caption a {
    color: #3f3f3f;
  }
  .card-title {
    margin-bottom: 0;
}
</style>

<body>
  <!-- Responsive navbar-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-lg-5">
      <a class="navbar-brand" href="#!">Version5</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span
          class="navbar-toggler-icon"></span></button>
    </div>
  </nav>
  <!-- Header-->
  <!-- Page Content-->
  <section id="myDiv" class="pt-4">
    <div id="myDiv2" class="container-fluid">
      <div id="myDiv3" class="row row-height">


        <div id="myDivLeft" class="col-md-4 left">
          <div class="card border-primary mb-3">
            <div class="card-body text-primary" style="text-align:center;">
              <h5 class="card-title" style="color:black">Instruction</h5>
            </div>
          </div>
          <div class="card border-primary mb-3">
            <div class="card-body text-primary">
              <p class="card-text" style="color:black">
                <ol>
                  <!-- <li style="color:red">Please find related texts from the novel on the left panel that best describe the comic image;</li>  -->
                  <!-- <li>Contextualized (is the annotation helpful in grasping the context) annotation</li> -->
                  <li style="color:black">Please take a look at the related texts from the novel on the left panel and describe the visual content <span style="color:red">"of the highlighted comic image"</span> such as <b>actors</b>(<i>e.g.</i>, people, animal)
                    , their <b>actions and expressions</b>(<i>e.g.</i>, walking, looking happy) 
                    and the <b>environment</b> where these actions take place(<i>e.g.</i>, gym, car);<br><br>
                  </li>
                  <span style="color:black">&#8251;</span><span style="color:black">Please use a minimum of 8 words;</span><br>
                  <span style="color:black">&#8251;</span><span style="color:black">Please kee your description concise overall;</span><br><br>
                  <!-- <span style="color:black">&#8251;</span><span style="color:red">Please Contextualized (is the annotation helpful in grasping the context) annotation;</span><br><br> -->
                  <!-- <li style="color:red">Please refer the sentences from the novel on the left panel that match the comic image;</li>  -->
                  <li style="color:black">
                    After describe the comic image below, then click <b>'Submit'</b> button for the MTurk code;<br>
                  </li>
                </ol>
              </p>
            </div>

        <div id="myDivMid" class="col-md-4 mid" style="text-align:center;"> 
          <div class="card border-primary mb-3">
            <div class="card-body text-primary" style="text-align:center;">
              <h5 class="card-title" style="color:black">Comic Image</h5>
            </div>
          </div>
        </div>


        <div id="myDivRight" class="col-md-4 right" color="black">
          <div class="card border-primary mb-3">
            <div class="card-body text-primary" style="text-align:center;">
              <h5 class="card-title" style="color:black">Instruction</h5>
            </div>
          </div>
          <div class="card border-primary mb-3">
            <div class="card-body text-primary">
              <p class="card-text" style="color:black">
                <ol>
                  <!-- <li style="color:red">Please find related texts from the novel on the left panel that best describe the comic image;</li>  -->
                  <!-- <li>Contextualized (is the annotation helpful in grasping the context) annotation</li> -->
                  <li style="color:black">Please take a look at the related texts from the novel on the left panel and describe the visual content <span style="color:red">"of the highlighted comic image"</span> such as <b>actors</b>(<i>e.g.</i>, people, animal)
                    , their <b>actions and expressions</b>(<i>e.g.</i>, walking, looking happy) 
                    and the <b>environment</b> where these actions take place(<i>e.g.</i>, gym, car);<br><br>
                  </li>
                  <span style="color:black">&#8251;</span><span style="color:black">Please use a minimum of 8 words;</span><br>
                  <span style="color:black">&#8251;</span><span style="color:black">Please kee your description concise overall;</span><br><br>
                  <!-- <span style="color:black">&#8251;</span><span style="color:red">Please Contextualized (is the annotation helpful in grasping the context) annotation;</span><br><br> -->
                  <!-- <li style="color:red">Please refer the sentences from the novel on the left panel that match the comic image;</li>  -->
                  <li style="color:black">
                    After describe the comic image below, then click <b>'Submit'</b> button for the MTurk code;<br>
                  </li>
                </ol>
              </p>
            </div>
          </div>

          <form>
            <div class="form-group">
              <div style="margin-bottom: 15px;">
                <textarea class="form-control" id="des1" rows="15"></textarea>
              </div>
              <div class="row" style="margin-bottom: 15px;">
          <button id="submitBtn" type="button" class="btn btn-primary">Submit</button>

        </div>
      </div>
    </div>
  </section>
  <!-- Footer-->
  <footer class="py-5 bg-dark">
    <div class="container">
      <p class="m-0 text-center text-white">Copyright &copy; Your Website 2022</p>
    </div>
  </footer>
  <!-- Bootstrap core JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="bootstrap.bundle.min.js / bootstrap.bundle.js"></script> -->
  <!-- Core theme JS-->
  <script src="js/scripts.js"></script>
</body>

<script>
    // Import the functions you need from the SDKs you need
  //   import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";
  // import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  (function () {

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      // const firebaseConfig = {
      //   apiKey: "AIzaSyC_mHdFFuhGGSmo7UvZ2xGw_EQcnzhXon0",
      //   authDomain: "accesscomics3-74671.firebaseapp.com",
      //   databaseURL: "https://accesscomics3-74671-default-rtdb.firebaseio.com",
      //   projectId: "accesscomics3-74671",
      //   storageBucket: "accesscomics3-74671.appspot.com",
      //   messagingSenderId: "593599091950",
      //   appId: "1:593599091950:web:300345d836dcfd64ac8fff",
      //   measurementId: "G-Z1PM2PH5DR"
      // };

      // // Initialize Firebase
      // const app = initializeApp(firebaseConfig);
      // const analytics = getAnalytics(app);
    
    //모든 html 페이지가 화면에 뿌려지고 나서 저 ready안에 서술된 이벤트들이 동작준비를 하는것
    jQuery(document).ready(function () {

      const adj = ['Alcoholic', 'Silent', 'Big', 'Difficult', 'Courageous', 'Fancy', 'Cruel', 'Materialistic', 'Childlike', 'Ruthless',
        'Flawless', 'Doubtful', 'Jealous', 'Husky', 'Enchanted', 'Idiotic', 'Giant', 'Boring', 'Determined', 'Irritating'];
      const animal = ['Sheep', 'Chimpanzee', 'Antelope', 'Bear', 'Fox', 'Cat', 'Puma', 'Ape', 'Cow', 'Koala',
        'Deer', 'Parrot', 'Donkey', 'Gorilla', 'Alpaca', 'Hamster', 'Frog', 'Elephant', 'Alligator', 'Dingo'];
      const adj_animal = [];
      for (var i in adj) {
        for (var j in animal) {
          adj_animal.push(adj[i] + " " + animal[j])
        }
      }
      // Create session name
      var condition = 5;
      var newSessionName = 'vaa55'+condition+'_'+ adj_animal[Math.floor(Math.random() * adj_animal.length)] + Date.now();
    
      //const databaseURL = "https://accesscomics3mturk-default-rtdb.asia-southeast1.firebasedatabase.app/"+newSessionName;
      const databaseURL = "https://accesscomics3mturkv5-default-rtdb.asia-southeast1.firebasedatabase.app/"+newSessionName;
      const db = ['/annotations1', '/annotations2'];

      sendData = (dataDict, index) => {
        //console.log(dataDict)
             return fetch( `${databaseURL+ db[index]}/.json`, {
                    method: 'POST',
                    body: JSON.stringify(dataDict)
             }).then(res => {
            if (res.status !== 200) {
                    throw new Error(res.statusText);
            }
            return res.json();
            }).then((res) => {
            //console.log(+ index + ” succesfully sent!“)
            })
        };


      //초기화 변수
      var starttime = new Date().getTime();
      
      const query = window.location.href;
      const param = new URLSearchParams(query);
      const cuti = param.get('n');
      console.log(cuti);
      
      if(cuti==1){ imgAnno = 'Dungeon_2'; Datai=0;}
      else if(cuti==2){ imgAnno = 'Dungeon_3'; Datai=0;} 
      else if(cuti==3){ imgAnno = 'Dungeon_4'; Datai=0;}
      else if(cuti==4){ imgAnno = 'Hourglass_2'; Datai=1;}
      else if(cuti==5){ imgAnno = 'Hourglass_3'; Datai=1;}
      else if(cuti==6){ imgAnno = 'Hourglass_4'; Datai=1;}
      else if(cuti==7){ imgAnno = 'MyLife_2'; Datai=2;}
      else if(cuti==8){ imgAnno = 'MyLife_3'; Datai=2;}
      else if(cuti==9){ imgAnno = 'MyLife_4'; Datai=2;}

      console.log(imgAnno);
      
      var title = imgAnno.split('_')[0];
      var cutii = Number(imgAnno.split('_')[1]);
      console.log(title);
      console.log(cutii);
      var imgSrc_0 = '../assets/Tappytoon/Mturk/'+title+'_'+(cutii-1)+'.jpg';
      var imgSrc = '../assets/Tappytoon/Mturk/'+imgAnno+'.jpg';
      var imgSrc_2 = '../assets/Tappytoon/Mturk/'+title+'_'+(cutii+1)+'.jpg';
      
      //이미지
      function getImg() {
        imgInput = '<div><img width="400px" src="' + imgSrc_0 + '" "></div>'
        imgInput = imgInput + '<div><img width="400px" src="' + imgSrc + '" style="border: 10px solid red;""></div>'
        imgInput = imgInput + '<div><img width="400px" src="' + imgSrc_2 + '" "></div>'
        
        $('#myDivMid').append(imgInput);

        // for (var i = 0; i < cuti.length; i++) {
        //   var imgSrc = '../assets/Tappytoon/Dungeon/Dungeon_img_test/Dungeon_01_' + cuti[i] + '.jpg';
        //   var imgInput = '<div><img src="' + imgSrc + '" width="400px"></div>'
        //   if (cuti[i] == cut) {
        //     imgInput = '<div><img src="' + imgSrc + '" id="hallstatt" width="400px" style="border: 10px solid red;"></div>'
        //   }
        //   // console.log(imgInput);
        //   $('#myDivMid').append(imgInput);
        
      }
      getImg();


      //소설
      function readJSON(file, callback) {
        var rawFile = new XMLHttpRequest();
        rawFile.overrideMimeType("application/json");
        rawFile.open("GET", file, true);
        rawFile.onreadystatechange = function () {
          if (rawFile.readyState === 4 && rawFile.status == "200") {
            callback(rawFile.responseText);
          }
        }
        rawFile.send(null);
      }
      readJSON("../assets/Novel_242.json", function (text) {
        var Data = JSON.parse(text);
        $('#comicnovel').append(Data[Datai].novel_txt);
        $('#comicnovel').append("<br>");
      });
      // if(Datai==0){text = "[Oopsie, be careful! Historic sites like these always have just as many traps as treasures!";}// It's one of the rules of the dungeon, you know!]";}//<br><br>The annoyingly cheery voice echoed from a distance.<br>That damned assistant only offered advice after someone died.<br>Jung Dawoon was at the bottom of a deep pit. The ground was covered in sharp, metal spikes.<br>One of the spikes had pierced his stomach. Jung Dawoon was dying.<br><br>“Damn it.\"<br><br>With the last of his strength, he pulled the spike from his body.<br>He then crawled across the floor and leaned against the wall.<br>Weakly, he looked up and saw a circle of light at the end of the deep darkness.<br>It was the opening of the trap he'd fallen into.<br><br><i>To think some treasure blinded me when I'd gotten so far...</i><br><br>His regret was palpable.<br>He had no one to blame; it had been his own mistake that had doomed him.<br><br><i>So this is how I die?</i><br><br>His vision began to fade.<br>He must have lost too much blood.<br>His body was getting progressively colder.<br>There was a ringing in his ears, and his head was blank.<br>\nHis senses were growing dull, and everything felt far away.<br>He'd struggled so much to survive, but now he was at death's door.";}
      // else if(Datai==1){ text = "Irritated gazes fell on Aria, who was blankly staring at her hand. Everyone knew that soon the vulgar girl would scream.<br>People braced themselves for this eventuality. No gestures of pity were offered to Aria. She had already lost their trust.<br>Aria closed her eyes. After briefly considering what to do next, she opened her eyes and let a calm expression fall over her face.<br><br>“Pass me a handkerchief, Jessie. I seem to have hurt my leg, so I will need you to tend to the wound. My apologies to everyone, but I will have to leave the meal early.”<br><br>Against everyone's expectations, Aria had chosen to react calmly instead of screaming.<br>She took the handkerchief from her maid and wiped her hand, then left her seat after apologizing for creating a disturbance.<br>Everyone seated around the table froze, taken aback by Aria's unexpected reaction.";}
      // else if(Datai==2){ text = "Up to that point, my morning was no different from usual. I stood peacefully in front of the closet. When I saw the snowwhite school uniform that hung from the closet door, I found myself at a loss, however. <br><br><i>Huh?</i>&nbsp; Brows deeply furrowed, I stared at the uniform for a while. I rubbed my eyes. Nothing changed, so this time I tried banging my head against the wall. When I turned towards the closet again, I saw the same uniform hanging there.<br><br><i>What is this?&nbsp;</i>  I thought, holding the uniform. It resembled a patient's gown from some psychiatric ward the more I looked at it. The jacket was pure white, and so was the dress. The vest was a light beige, but that wasn't much of a consolation. If I put this on and buttoned my jacket, I'd be white from head to toe.<br><br>One thing I found a relief was that this was not my school's uniform. My school's uniform came in an ordinary navy color.<br><br>I stood there staring vacantly for a while before calling out to my mom.<br><br>\"Mom, where's my uniform?\"<br>\"Huh?\"<br><br>My mom, having just finished doing the dishes in the kitchen, appeared at my door. I shook the white uniform at her.<br><br>\"Mom, this isn't my school's uniform! Where's mine?\"<br>\"What are you saying, child? You went to get that fitted last week. That <i>is</i>&nbsp; your uniform!\"<br>\"Huh?\"<br>\"What?\"<br>";}
      // var Data = JSON.parse(text);
      // $('#comicnovel').append(Data[Datai].novel_txt);
      // $('#comicnovel').append("<br>");
      

      // json 파일로 출력
      var saveAnno = [];
      var MiniAnno = 
      {
          //기본annotation정보
          "condition" : condition,
          "userId": newSessionName,
          "comic" : imgAnno,
          "@context": imgSrc,
          //바뀌는 정보
          "annotation":[
          ]
      }
      $('#submitBtn').click(function () {
        console.log('Submit!!');

        // 최소 글자 수 
        des1Cnt = $('#des1').val().length;
        if(des1Cnt>0) des1Cnt = $('#des1').val().match(/\w+/g).length;

        var alertStr = "";

        if(des1Cnt<8){
          alertStr = alertStr + "Please write at least 8 words";
          alertStr = alertStr + "\n";
          alert(alertStr);
        }

        else
        {
          alert('Submit!');
          MiniAnno.scene = $('#des1').val();
          var endTime = new Date().getTime();
          MiniAnno.time = endTime-starttime;
          sendData(MiniAnno, 0);
          sendData(saveAnno, 1);

          localStorage.setItem('key_code', newSessionName);
          window.open('annotation_submit.html', 'childForm').focus();
        
        }

      })
      

    });
  }());

</script>

<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script> -->

</html>